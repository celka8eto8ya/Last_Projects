[
  {
    "Id": "1491542",
    "ThreadId": "660889",
    "Html": "Hi,\r<br />\n \r<br />\ni have develop winfrom application using media file, recording and editing with wave form. \r<br />\nreceiving input through microphone is possible draw wave form the same not possible when tried to record output of a system (Speakers) find the below code and suggest better way to achieve the same.\r<br />\nMic codes used:\r<br />\n \r<br />\nprivate void RecorderOnDataAvailable(object sender, WaveInEventArgs waveInEventArgs)\r<br />\n{\r<br />\ntry\r<br />\n{\r<br />\nbufferedWaveProvider.AddSamples(waveInEventArgs.Buffer, 0, waveInEventArgs.BytesRecorded);\r<br />\nbyte[] waveData = new byte[100 * Bytes_Per_Sample1];\r<br />\nshort low = 0;\r<br />\nshort high = 0;\r<br />\nfor (int n = 0; n &lt; waveInEventArgs.BytesRecorded; n += 2)\r<br />\n{\r<br />\nshort sample = BitConverter.ToInt16(waveInEventArgs.Buffer, n);\r<br />\nif (sample &lt; low)\r<br />\nlow = sample;\r<br />\nif (sample &gt; high)\r<br />\nhigh = sample;\r<br />\n}\r<br />\nfloat lowPercent = ((((float)low) - short.MinValue) / ushort.MaxValue);\r<br />\nfloat highPercent = ((((float)high) - short.MinValue) / ushort.MaxValue);\r<br />\ng.DrawLine(Draw_lIne, d, Wave_Control_Main_Player.Height * lowPercent, d, Wave_Control_Main_Player.Height * highPercent);\r<br />\nd++;\r<br />\nif (d == Wave_Control_Main_Player.Width)\r<br />\n{\r<br />\nWave_Control_Main_Player.Invalidate();\r<br />\nd = 0;\r<br />\n}\r<br />\n} \r<br />\nUsed for capturing:\r<br />\nWasapiLoopbackCapture class used to get the output sounds. \r<br />\n \r<br />\n \r<br />\npublic void OnDataAvailable(object sender, WaveInEventArgs e)\r<br />\n{\r<br />\n_writer.Write(e.Buffer, 0, e.BytesRecorded);\r<br />\n//byte[] waveData = new byte[100 * Bytes_Per_Sample1];\r<br />\n//short low = 0;\r<br />\n//short high = 0;\r<br />\n//stream.Read(waveData, 0, waveData.Length);\r<br />\n//for (int n = 0; n &lt; waveData.Length; n += 8)\r<br />\n//{\r<br />\n// short sample = BitConverter.ToInt16(waveData, n);\r<br />\n// if (sample &lt; low) low = sample;\r<br />\n// if (sample &gt; high)\r<br />\n// high = sample;\r<br />\n//}\r<br />\n//float lowPercent = ((((float)low) - short.MinValue) / ushort.MaxValue);\r<br />\n//float highPercent = ((((float)high) - short.MinValue) / ushort.MaxValue);\r<br />\n//g.DrawLine(Draw_lIne, d, Wave_Control_Main_Player.Height * lowPercent, d, Wave_Control_Main_Player.Height * highPercent);\r<br />\n//d++;\r<br />\n//if (d == Wave_Control_Main_Player.Width)\r<br />\n//{\r<br />\n// Wave_Control_Main_Player.Invalidate();\r<br />\n// d = 0;\r<br />\n//}\r<br />\n}<br />\n",
    "PostedDate": "2017-01-23T22:19:40.947-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]