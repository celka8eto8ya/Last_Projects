[
  {
    "Id": "946620",
    "ThreadId": "404496",
    "Html": "\r\n<p>I wrote a small test program in vb.net 2012 , the program is to record &quot;what you hear&quot; using the new WasapiCapture class.&nbsp;&nbsp; Upon&nbsp; invoking the wasapi.startrecording function, I&nbsp; get a ComException from NAudio. I searched Microsoft\r\n KB but the exception number was not there</p>\r\n<p>&nbsp;</p>\r\n<p>has anyone encountered something similar?</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>the code is as follows:</p>\r\n<p>Imports naudio<br>\r\nImports naudio.wave<br>\r\nImports NAudio.CoreAudioApi<br>\r\n<br>\r\nPublic Class Form1<br>\r\n&nbsp;&nbsp;&nbsp; Dim WithEvents Wasapi As WasapiCapture<br>\r\n&nbsp;&nbsp;&nbsp; Dim Writer As WaveFileWriter<br>\r\n&nbsp;&nbsp;&nbsp; Dim WvFormat As WaveFormat<br>\r\n&nbsp;&nbsp;&nbsp; Dim mmdev As MMDeviceEnumerator<br>\r\n&nbsp;&nbsp;&nbsp; Dim audio As MMDevice<br>\r\n<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mmdev = New MMDeviceEnumerator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; audio = mmdev.GetDefaultAudioEndpoint(DataFlow.Render, Role.Multimedia)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WvFormat = audio.AudioClient.MixFormat<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi = New WasapiCapture(audio)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.WaveFormat = WvFormat<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer = New WaveFileWriter(&quot;E:\\2.wav&quot;, WvFormat)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Application.Exit()<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Wasapi_DataAvailable(sender As Object, e As WaveInEventArgs) Handles Wasapi.DataAvailable<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Write(e.Buffer, 0, e.BytesRecorded)<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.StartRecording()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi = Nothing<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Writer IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Flush()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Close()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Wasapi_RecordingStopped(sender As Object, e As EventArgs) Handles Wasapi.RecordingStopped<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '''''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Writer IsNot Nothing Then Writer.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then Wasapi.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp; <br>\r\nEnd Class</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-11-25T04:37:34.883-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "946723",
    "ThreadId": "404496",
    "Html": "\r\n<p>please post the full exception ToString of your COM exception, including the stack trace. Also, what version of Windows are you using? WASAPI is only supported in Vista and above</p>\r\n<p>Mark</p>\r\n",
    "PostedDate": "2012-11-25T11:10:37.143-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "946726",
    "ThreadId": "404496",
    "Html": "\r\n<p>Hi Mark,</p>\r\n<p>I am using Windows7 x64</p>\r\n<p>&nbsp;</p>\r\n<p>the exception details:</p>\r\n<p>&nbsp;</p>\r\n<p>system.runtime.interopservices.ComException {&quot;Exception from HRESULT: 0x88890003&quot;}</p>\r\n<p>&nbsp;</p>\r\n<p>the stack :</p>\r\n<p>&nbsp;</p>\r\n<p>System.Runtime.InteropServices.COMException was unhandled<br>\r\n&nbsp; HResult=-2004287485<br>\r\n&nbsp; Message=Exception from HRESULT: 0x88890003<br>\r\n&nbsp; Source=NAudio<br>\r\n&nbsp; ErrorCode=-2004287485<br>\r\n&nbsp; StackTrace:<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at NAudio.CoreAudioApi.Interfaces.IAudioClient.GetService(Guid& interfaceId, Object& interfacePointer)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at NAudio.CoreAudioApi.AudioClient.get_AudioCaptureClient()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at NAudio.CoreAudioApi.WasapiCapture.CaptureThread(AudioClient client)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at NAudio.CoreAudioApi.WasapiCapture.&lt;StartRecording&gt;b__0()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart_Context(Object state)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at System.Threading.ThreadHelper.ThreadStart()<br>\r\n&nbsp; InnerException:</p>\r\n",
    "PostedDate": "2012-11-25T11:15:53.807-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "946728",
    "ThreadId": "404496",
    "Html": "\r\n<p>OK, you should be using WasapiLoopbackCapture. Read this thread for more info:</p>\r\n<p><a href=\"https://naudio.codeplex.com/discussions/246592\">https://naudio.codeplex.com/discussions/246592</a></p>\r\n<p>Mark</p>\r\n",
    "PostedDate": "2012-11-25T11:22:35.367-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "946730",
    "ThreadId": "404496",
    "Html": "\r\n<p>Thanks Mark for your help. i have changed the audio device code to read:</p>\r\n<p>audio = mmdev.GetDefaultAudioEndpoint(DataFlow.Capture, Role.Multimedia)</p>\r\n<p>&nbsp;</p>\r\n<p>now the program seems working without exceptions, but no data is written when calling wasapi.startrecording() method.</p>\r\n<p>have i missed any point in your reply?</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-11-25T11:36:49.83-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "946731",
    "ThreadId": "404496",
    "Html": "\r\n<p>you should also be using WasapiLoopbackCapture not WasapiCapture</p>\r\n<p>Mark</p>\r\n",
    "PostedDate": "2012-11-25T11:40:17.073-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "947447",
    "ThreadId": "404496",
    "Html": "\r\n<p>Hi Mark,</p>\r\n<p>&nbsp;</p>\r\n<p>i think this worth notice: the below code works fine (despite the audio is set to &quot;dataflow.render&quot; mode , rather than &quot;dataflow.capture&quot; mode) as per the discussion in the above link.</p>\r\n<p>the only thing i noticed is : when calling the &quot;wasapi.stoprecording method, the software freezes, i am still working on it.</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>the code now looks as follows:</p>\r\n<p>&nbsp;</p>\r\n<p>Imports naudio<br>\r\nImports naudio.wave<br>\r\nImports NAudio.CoreAudioApi<br>\r\n<br>\r\n<br>\r\nPublic Class Form1<br>\r\n&nbsp;&nbsp;&nbsp; Dim WithEvents Wasapi As WasapiLoopbackCapture<br>\r\n&nbsp;&nbsp;&nbsp; Dim Writer As WaveFileWriter<br>\r\n&nbsp;&nbsp;&nbsp; Dim mmdev As MMDeviceEnumerator<br>\r\n&nbsp;&nbsp;&nbsp; Dim Audio As MMDevice<br>\r\n<br>\r\n<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mmdev = New MMDeviceEnumerator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Audio.AudioClient.Initialize(AudioClientShareMode.Shared, AudioClientStreamFlags.Loopback, 10000000, 0, Audio.AudioClient.MixFormat, System.Guid.Empty)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Audio = mmdev.GetDefaultAudioEndpoint(DataFlow.Render, Role.Multimedia)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi = New WasapiLoopbackCapture(Audio)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer = New WaveFileWriter(&quot;E:\\4.wav&quot;, Audio.AudioClient.MixFormat)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.WaveFormat = Audio.AudioClient.MixFormat<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Application.Exit()<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Wasapi_DataAvailable(sender As Object, e As WaveInEventArgs) Handles Wasapi.DataAvailable<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Write(e.Buffer, 0, e.BytesRecorded)<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.StartRecording()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.StopRecording()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi = Nothing<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Writer IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Flush()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Close()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer = Nothing<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Wasapi_RecordingStopped(sender As Object, e As EventArgs) Handles Wasapi.RecordingStopped<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '''''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Writer IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Flush()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Close()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer = Nothing<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.StopRecording()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi = Nothing<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp; <br>\r\nEnd Class</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-11-26T23:56:26.103-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "947797",
    "ThreadId": "404496",
    "Html": "\r\n<p>when you call stoprecording, don't immediately dispose Wasapi and set it to nothing - that should be done in the RecordingStopped handler</p>\r\n",
    "PostedDate": "2012-11-27T09:12:36.713-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "947832",
    "ThreadId": "404496",
    "Html": "\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>that's right,&nbsp; i made slight modifications, the final code for those who write in VB.Net&nbsp; is:</p>\r\n<p>&nbsp;</p>\r\n<p>Imports naudio<br>\r\nImports naudio.wave<br>\r\nImports NAudio.CoreAudioApi<br>\r\n<br>\r\n<br>\r\nPublic Class Form1<br>\r\n&nbsp;&nbsp;&nbsp; Dim WithEvents Wasapi As WasapiLoopbackCapture<br>\r\n&nbsp;&nbsp;&nbsp; Dim Writer As WaveFileWriter<br>\r\n&nbsp;&nbsp;&nbsp; Dim mmdev As MMDeviceEnumerator<br>\r\n&nbsp;&nbsp;&nbsp; Dim Audio As MMDevice<br>\r\n<br>\r\n<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mmdev = New MMDeviceEnumerator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Audio = mmdev.GetDefaultAudioEndpoint(DataFlow.Render, Role.Multimedia)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi = New WasapiLoopbackCapture(Audio)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer = New WaveFileWriter(&quot;E:\\4.wav&quot;, Audio.AudioClient.MixFormat)<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button3_Click(sender As Object, e As EventArgs) Handles ExitProgram.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '''''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Writer IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Flush()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Close()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer = Nothing<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.StopRecording()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.Dispose()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi = Nothing<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Application.Exit()<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Wasapi_DataAvailable(sender As Object, e As WaveInEventArgs) Handles Wasapi.DataAvailable<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Write(e.Buffer, 0, e.BytesRecorded)<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button1_Click(sender As Object, e As EventArgs) Handles StartRecording.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.StartRecording()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''''<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button2_Click(sender As Object, e As EventArgs) Handles StopRecording.Click<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Wasapi.StopRecording()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Wasapi_RecordingStopped(sender As Object, e As EventArgs) Handles Wasapi.RecordingStopped<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '''''<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Writer IsNot Nothing Then<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Writer.Flush()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\n<br>\r\n&nbsp;&nbsp; <br>\r\n&nbsp;&nbsp;&nbsp; Private Sub Button4_Click(sender As Object, e As EventArgs)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Wasapi IsNot Nothing Then<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ''<br>\r\n&nbsp;&nbsp;&nbsp; End Sub<br>\r\nEnd Class</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-11-27T10:19:00.79-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]