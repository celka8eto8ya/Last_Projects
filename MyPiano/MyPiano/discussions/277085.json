[
  {
    "Id": "688840",
    "ThreadId": "277085",
    "Html": "\r\n<p>I am setting up audio playback this way:</p>\r\n<pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>private</span>&nbsp;<span>IWavePlayer</span>&nbsp;GetWavePlayer(<span>int</span>&nbsp;deviceNumber&nbsp;=&nbsp;0)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>WasapiOut</span>&nbsp;wavePlayer&nbsp;=&nbsp;<span>new</span>&nbsp;<span>WasapiOut</span>(<span>AudioClientShareMode</span>.Shared,&nbsp;<span>false</span>,&nbsp;300);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wavePlayer.PlaybackStopped&nbsp;&#43;=&nbsp;OnPlaybackStopped;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wavePlayer.Init(_provider);\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wavePlayer.Play(); // &lt;-- this line causes exception if speakers are disabled\r\n \r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>return</span>&nbsp;wavePlayer;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre>\r\n<p>While playing audio using&nbsp;WasapiOut and disabling current speaker causes the following exception:</p>\r\n<p><em>System.Runtime.InteropServices.COMException was unhandled</em><br>\r\nMessage=<em>Exception from HRESULT: 0x88890004</em><br>\r\nSource=<em>NAudio&nbsp; ErrorCode=-2004287484</em><br>\r\nStackTrace:<br>\r\n<em>&nbsp; &nbsp; &nbsp; &nbsp;at NAudio.CoreAudioApi.Interfaces.IAudioClient.GetCurrentPadding(Int32&amp; currentPadding)</em><br>\r\n<em>&nbsp; &nbsp; &nbsp; &nbsp;at NAudio.Wave.WasapiOut.PlayThread() in I:\\Repository\\Sample\\NAudio Source\\NAudio\\Wave\\WaveOutputs\\WasapiOut.cs:line 134</em><br>\r\n<em>&nbsp; &nbsp; &nbsp; &nbsp;at System.Threading.ThreadHelper.ThreadStart_Context(Object state)</em><br>\r\n<em>&nbsp; &nbsp; &nbsp; &nbsp;at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)</em><br>\r\n<em>&nbsp; &nbsp; &nbsp; &nbsp;at System.Threading.ThreadHelper.ThreadStart()</em></p>\r\n<p>This lead me to</p>\r\n<p>WasapiOut.cs&nbsp;line 134:</p>\r\n<p><em><span style=\"font-family:Consolas,'Courier New',Courier,monospace; white-space:pre\">numFramesPadding&nbsp;=&nbsp;audioClient.CurrentPadding;</span></em></p>\r\n<p><span style=\"font-family:Consolas,'Courier New',Courier,monospace; white-space:pre\">And:</span></p>\r\n<pre><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;///&nbsp;&lt;summary&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;///&nbsp;Gets&nbsp;the&nbsp;current&nbsp;padding&nbsp;(must&nbsp;initialize&nbsp;first)\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;///&nbsp;&lt;/summary&gt;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;int&nbsp;CurrentPadding\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;currentPadding;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Marshal.ThrowExceptionForHR(audioClientInterface.GetCurrentPadding(out&nbsp;currentPadding));\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;currentPadding;\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</em></pre>\r\n<p><span style=\"font-family:Consolas,'Courier New',Courier,monospace; white-space:pre\">I guess the &quot;</span><span style=\"font-family:Consolas,'Courier New',Courier,monospace; white-space:pre\">audioClientInterface&quot; is NULL if no audio output device is available.</span></p>\r\n<p><span style=\"font-family:Consolas,'Courier New',Courier,monospace; white-space:pre\">Is there a way to get around the unhandled COM exception as I am not able to catch it in my application?</span></p>\r\n<p><span style=\"font-family:Consolas,'Courier New',Courier,monospace; white-space:pre\">Similar problem were with WaveIn: &quot;no recording devices on Windows 7 / Vista?&quot; (<a href=\"http://naudio.codeplex.com/discussions/274165\">http://naudio.codeplex.com/discussions/274165</a>)\r\n and this were fixed here <a href=\"http://naudio.codeplex.com/SourceControl/network/Forks/bobasaurus/recordingPullCableFix\">\r\nhttp://naudio.codeplex.com/SourceControl/network/Forks/bobasaurus/recordingPullCableFix</a>.</span></p>\r\n<p>Probably I could think out a hack how to fix the symptom in the NAudio source but I would prefer not to make local changes that would be overwritten with new release of NAudio.</p>\r\n<p>What would be the right way to handle audio endpoint addition and removal or change of default device in theory?<br>\r\nWhat about device event notifications?&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks</p>\r\n",
    "PostedDate": "2011-10-25T01:19:34.96-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "692220",
    "ThreadId": "277085",
    "Html": "<p>Yes, probably there should be a way that WasapiOut can report device removed with an event you can subscribe to and then simply stop playback if the device is removed. We could even make the PlaybackStopped event have some kind of way of reporting the reason for playback stopped.</p>",
    "PostedDate": "2011-11-01T09:22:52.293-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]