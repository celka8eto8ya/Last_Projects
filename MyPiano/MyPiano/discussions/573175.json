[
  {
    "Id": "1326231",
    "ThreadId": "573175",
    "Html": "Hi Mark\r<br />\ni am wring data from WaveinEvent eventhandler to serial COM port of GSM Modem. But I am hearing distorted sound on other side. Following is my code: \r<br />\n<br />\nprivate void button1_Click(object sender, EventArgs e)<br />\n<pre><code>{\n\n\n    Talking = new SerialPort(&quot;COM5&quot;, 9600, Parity.None, 8, StopBits.One);\n    Talking.Open();\n\n    wi = new WaveInEvent  ();\n   wi.WaveFormat = new WaveFormat(44100, 16, 1);\n    int waveInDevices = WaveIn.DeviceCount;\n    for (int waveInDevice = 0; waveInDevice &lt; waveInDevices; waveInDevice++)\n    {\n        WaveInCapabilities deviceInfo = WaveIn.GetCapabilities(waveInDevice);\n\n    }\n\n    // wi.BufferMillisconds = 05;\n\n    wi.DeviceNumber = 0;\n\n    int waveInDeviceNumber = 0;\n\n\n       wi.DataAvailable += new EventHandler&lt;WaveInEventArgs&gt;(wi_DataAvailable);\n       wi.StartRecording();\n\n}\n\n</code></pre>\n\nvoid wi_DataAvailable(object sender, WaveInEventArgs e)<br />\n<pre><code>{</code></pre>\n\nbyte[] source = e.Buffer;<br />\n<pre><code>    Stream  byteStream12 = new MemoryStream(source);\n  byte []  bt  = ConvertNonSeekableStreamToByteArray(byteStream12);\n  Buffer.BlockCopy(bt, 0, resampleStream.SourceBuffer, 0, bt.Length);\n\n    int sourceBytesConverted = 0;\n    var convertedBytes = resampleStream.Convert(bt.Length, out sourceBytesConverted);\n    if (sourceBytesConverted != bt.Length)\n    {\n        MessageBox.Show(&quot;We didn't convert everything {0} bytes in, {1} bytes converted&quot;);\n    }\n\n    var converted = new byte[convertedBytes];\n\n    Buffer.BlockCopy(resampleStream.DestBuffer, 0, converted, 0, convertedBytes);\n\n\n\n    MemoryStream byteStream1 = new MemoryStream(converted );\n\n    Talking.DiscardInBuffer();\n    while (byteStream1.Read(buffer2, offset, audioBufferSize) &gt; 0)\n    {\n        Talking.DiscardInBuffer();\n        Talking.Write(buffer2, offset, audioBufferSize);\n        PauseForMilliSeconds(30);\n    }</code></pre>\n\n} \r<br />\n<br />\n<br />\n<br />\n<br />\n<br />\n<br />\nstatic byte[] ConvertNonSeekableStreamToByteArray(Stream NonSeekableStream)<br />\n<pre><code>{\n    MemoryStream ms = new MemoryStream();\n    byte[] buffer = new byte[1024];\n    int bytes;\n\n\n    while ((bytes = NonSeekableStream.Read(buffer, 0, buffer.Length)) &gt; 0)\n    {\n        ms.Write(buffer, 0, bytes);\n    }\n    byte[] output = ms.ToArray();\n    return output;\n}\n\n</code></pre>\n\nHere is declaration part:\r<br />\n SerialPort Talking;<br />\n<pre><code>      private BufferedWaveProvider bwp;\n    public WaveInEvent wi;\n       private WaveIn recorder;\n    private BufferedWaveProvider bufferedWaveProvider;\n    private SavingWaveProvider savingWaveProvider;\n    AcmStream resampleStream = new AcmStream(new WaveFormat(44100, 16, 2), new WaveFormat(8000, 8, 2));\n\n</code></pre>\n\nPlease help me. I shall be thankful to you. \r<br />\n<br />\nRegards Rakesh Kumar<br />\n",
    "PostedDate": "2014-11-26T00:02:12.757-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]