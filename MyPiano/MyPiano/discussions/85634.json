[
  {
    "Id": "291646",
    "ThreadId": "85634",
    "Html": "<p>Hi I have built two apps, one is a windows form which plays a wav file (This works fine). The Second is a windows service which plays a wav file. The second&nbsp;is using the same code as the windows form however some wav files it doesnt play at all and others it seems to speed up and only play about 1 second of the file...... Does anyone have any ideas?</p>\r\n<p>Cheers<br>Chris</p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">\r\n<p><span style=\"color:#0000ff\">Imports NAudio.Wave</span></p>\r\n<p><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">\r\n<p><span style=\"color:#0000ff\">Public </span></p>\r\n</span></span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff\">Class</span></span><span style=\"color:#0000ff\"><span style=\"font-size:x-small\"> AudioServer<br></span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Private</span></span><span style=\"font-size:x-small\"> newwave </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">As</span></span><span style=\"font-size:x-small\"> </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">New</span></span></span><span style=\"color:#0000ff\"><span style=\"font-size:x-small\"> NAudio.Wave.WaveOut<br></span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Private</span></span><span style=\"font-size:x-small\"> inputstream </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">As</span></span></span><span style=\"color:#0000ff\"><span style=\"font-size:x-small\"> NAudio.Wave.WaveChannel32<br></span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Public</span></span><span style=\"font-size:x-small\"> </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Event</span></span><span style=\"font-size:x-small\"> OnSample </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">As</span></span><span style=\"font-size:x-small\"> EventHandler(</span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Of</span></span></span><span style=\"font-size:x-small\"><span style=\"color:#0000ff\"> SampleEventArgs)<br><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Protected</span></span><span style=\"font-size:x-small\"> </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Overrides</span></span><span style=\"font-size:x-small\"> </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">Sub</span></span><span style=\"font-size:x-small\"> OnStart(</span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">ByVal</span></span><span style=\"font-size:x-small\"> args() </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">As</span></span><span style=\"font-size:x-small\"> </span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">String</span></span></span><span style=\"color:#0000ff\">)<br>Play(&quot;C:\\doh.wav&quot;)<br></span><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff\">End Sub</span><br>&nbsp;Private Sub Play(ByVal Filename As String)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CreateInputStream(Filename)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newwave.Init(inputstream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If newwave IsNot Nothing AndAlso inputstream IsNot Nothing AndAlso newwave.PlaybackState &lt;&gt; PlaybackState.Playing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newwave.Play()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newwave.Dispose()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</span></span></span></p>\r\n</span></span><span style=\"color:#0000ff\"><span style=\"font-size:x-small\"><br></span></span></p>\r\n<p><span style=\"font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\"><span style=\"color:#0000ff;font-size:x-small\">&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Shared Function OpenWavStream(ByVal fileName As String) As WaveChannel32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim inputStream As WaveChannel32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim readerStream As WaveStream = New WaveFileReader(fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If readerStream.WaveFormat.Encoding &lt;&gt; WaveFormatEncoding.Pcm Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readerStream = WaveFormatConversionStream.CreatePcmStream(readerStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readerStream = New BlockAlignReductionStream(readerStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If readerStream.WaveFormat.BitsPerSample &lt;&gt; 16 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim format = New WaveFormat(readerStream.WaveFormat.SampleRate, 16, readerStream.WaveFormat.Channels)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readerStream = New WaveFormatConversionStream(format, readerStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputStream = New WaveChannel32(readerStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return inputStream<br>&nbsp;&nbsp;&nbsp; End Function<br>&nbsp;&nbsp;&nbsp; Private Sub CreateInputStream(ByVal fileName As String)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If fileName.EndsWith(&quot;.wav&quot;) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputStream = OpenWavStream(fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf fileName.EndsWith(&quot;.mp3&quot;) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputStream = OpenMp3Stream(fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw New InvalidOperationException(&quot;Unsupported extension&quot;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'AddHandler inputStream.Sample, AddressOf inputStream_Sample<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Sub inputStream_Sample(ByVal sender As Object, ByVal e As SampleEventArgs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent OnSample(Me, e)<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Shared Function OpenMp3Stream(ByVal fileName As String) As WaveChannel32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim inputStream As WaveChannel32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim mp3Reader As WaveStream = New Mp3FileReader(fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim pcmStream As WaveStream = WaveFormatConversionStream.CreatePcmStream(mp3Reader)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim blockAlignedStream As WaveStream = New BlockAlignReductionStream(pcmStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputStream = New WaveChannel32(blockAlignedStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return inputStream<br>&nbsp;&nbsp;&nbsp; End Function<br>End Class</span></span></span></p>",
    "PostedDate": "2010-02-17T03:59:54.503-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "292360",
    "ThreadId": "85634",
    "Html": "<p>How far have you got debugging this?</p>\r\n<p>I suspect that you would have found everything works up until the point where you are playing the wave file? Or is it failing when you define the WaveOut?</p>\r\n<p>Normally you need to provide a HWND (Window Handle) for WaveOut to work, I haven't looked through the latest version of NAudio to see how this is working now but from the code you have provided you aren't specifying one, which I would suspect is your issue when you are running this from a service as a service doesn&rsquo;t display a window for you to get a handle from.</p>\r\n<p>If your using Windows 7 try using core audio rather than WaveOut as per this post on Stack Overflow:</p>\r\n<p><a href=\"http://stackoverflow.com/questions/2143439/play-wave-file-from-a-windows-service-c\">http://stackoverflow.com/questions/2143439/play-wave-file-from-a-windows-service-c</a></p>\r\n<p>&nbsp;~DSebJ</p>",
    "PostedDate": "2010-02-18T13:39:27.433-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "292386",
    "ThreadId": "85634",
    "Html": "<p>Hi, <br>&nbsp;&nbsp;&nbsp;&nbsp; I did manage to get this work in the end it was to do with the wasapi module. Here is the code, hopfully it will help someone.</p>\r\n<p>Imports NAudio.Wave<br>Imports NAudio.CoreAudioApi<br>Imports Microsoft.Win32</p>\r\n<p>Public Class AudioServer<br>&nbsp;&nbsp;&nbsp; Private newwave As NAudio.Wave.WasapiOut<br>&nbsp;&nbsp;&nbsp; Private inputstream As NAudio.Wave.WaveChannel32<br>&nbsp;&nbsp;&nbsp; Public Event OnSample As EventHandler(Of SampleEventArgs)<br>&nbsp;&nbsp;&nbsp; Private AudioServerKey As RegistryKey = Registry.LocalMachine.OpenSubKey(&quot;Software\\AudioServer&quot;, True)<br>&nbsp;&nbsp;&nbsp; Private AudioServerCommandsKey As RegistryKey = Registry.LocalMachine.OpenSubKey(&quot;Software\\AudioServer\\Commands&quot;, True)<br>&nbsp;&nbsp;&nbsp; Private checkAudioThread As System.Threading.Thread<br>&nbsp;&nbsp;&nbsp; Private ActiveCheckAudio As Boolean = True<br>&nbsp;&nbsp;&nbsp; Private PlayThread As System.Threading.Thread</p>\r\n<p>&nbsp;&nbsp;&nbsp; Protected Overrides Sub OnStart(ByVal args() As String)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Add code here to start your service. This method should set things<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' in motion so your service can do its work.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; checkAudioThread = New System.Threading.Thread(AddressOf CheckAudio)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ActiveCheckAudio = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; checkAudioThread.Start()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; End Sub</p>\r\n<p>&nbsp;&nbsp;&nbsp; Protected Overrides Sub OnStop()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ' Add code here to perform any tear-down necessary to stop your service.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ActiveCheckAudio = False<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Sub CheckAudio()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Do While ActiveCheckAudio<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If AudioServerKey.GetValue(&quot;Play&quot;) &lt;&gt; AudioServerKey.GetValue(&quot;LastPlay&quot;) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AudioServerKey.SetValue(&quot;LastPlay&quot;, AudioServerKey.GetValue(&quot;Play&quot;))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Play(AudioServerKey.GetValue(&quot;Play&quot;))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If AudioServerKey.GetValue(&quot;CommandPlay&quot;) &lt;&gt; &quot;&quot; Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Play(AudioServerCommandsKey.GetValue(AudioServerKey.GetValue(&quot;CommandPlay&quot;)))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AudioServerKey.SetValue(&quot;CommandPlay&quot;, &quot;&quot;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.Threading.Thread.Sleep(200)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Loop<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Sub Play(ByVal Filename As String)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CreateInputStream(Filename)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong> newwave = New NAudio.Wave.WasapiOut(AudioClientShareMode.Shared, False, 300) ' This was the Key to the whole thing.<br></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newwave.Init(inputstream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If newwave IsNot Nothing AndAlso inputstream IsNot Nothing AndAlso newwave.PlaybackState &lt;&gt; PlaybackState.Playing Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newwave.Play()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim newplaythread As New System.Threading.Thread(AddressOf playingthread)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newplaythread.Start()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Sub playingthread()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim looping As Boolean = True<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Do While looping<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If inputstream.Position &gt; inputstream.Length Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newwave.Stop()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; newwave.Dispose()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputstream.Dispose()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; looping = False<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Loop<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Shared Function OpenWavStream(ByVal fileName As String) As WaveChannel32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim inputStream As WaveChannel32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim readerStream As WaveStream = New WaveFileReader(fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If readerStream.WaveFormat.Encoding &lt;&gt; WaveFormatEncoding.Pcm Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readerStream = WaveFormatConversionStream.CreatePcmStream(readerStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readerStream = New BlockAlignReductionStream(readerStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If readerStream.WaveFormat.BitsPerSample &lt;&gt; 16 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim format = New WaveFormat(readerStream.WaveFormat.SampleRate, 16, readerStream.WaveFormat.Channels)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; readerStream = New WaveFormatConversionStream(format, readerStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputStream = New WaveChannel32(readerStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return inputStream<br>&nbsp;&nbsp;&nbsp; End Function<br>&nbsp;&nbsp;&nbsp; Private Sub CreateInputStream(ByVal fileName As String)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If fileName.EndsWith(&quot;.wav&quot;) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputStream = OpenWavStream(fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf fileName.EndsWith(&quot;.mp3&quot;) Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputStream = OpenMp3Stream(fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Throw New InvalidOperationException(&quot;Unsupported extension&quot;)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddHandler inputStream.Sample, AddressOf inputStream_Sample<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Sub inputStream_Sample(ByVal sender As Object, ByVal e As SampleEventArgs)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RaiseEvent OnSample(Me, e)<br>&nbsp;&nbsp;&nbsp; End Sub<br>&nbsp;&nbsp;&nbsp; Private Shared Function OpenMp3Stream(ByVal fileName As String) As WaveChannel32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim inputStream As WaveChannel32<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim mp3Reader As WaveStream = New Mp3FileReader(fileName)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim pcmStream As WaveStream = WaveFormatConversionStream.CreatePcmStream(mp3Reader)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dim blockAlignedStream As WaveStream = New BlockAlignReductionStream(pcmStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inputStream = New WaveChannel32(blockAlignedStream)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Return inputStream<br>&nbsp;&nbsp;&nbsp; End Function<br>End Class</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-02-18T14:27:09.197-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]