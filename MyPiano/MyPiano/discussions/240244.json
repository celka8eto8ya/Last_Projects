[
  {
    "Id": "543070",
    "ThreadId": "240244",
    "Html": "\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:#000000\">Hello, I'm trying to transfer voice from mic by udp socket. It worked to transfer bytes data and playback, but the sound heared like with echo effect.</span></pre>\r\n<pre><span style=\"color:#000000\">Could anyone tell me how to fix it?</span></pre>\r\n<pre><span style=\"color:blue\">using</span> System;\r\n<span style=\"color:blue\">using</span> System.Collections.Generic;\r\n<span style=\"color:blue\">using</span> System.ComponentModel;\r\n<span style=\"color:blue\">using</span> System.Data;\r\n<span style=\"color:blue\">using</span> System.Drawing;\r\n<span style=\"color:blue\">using</span> System.Linq;\r\n<span style=\"color:blue\">using</span> System.Text;\r\n<span style=\"color:blue\">using</span> System.Windows.Forms;\r\n<span style=\"color:blue\">using</span> System.Net.Sockets;\r\n<span style=\"color:blue\">using</span> System.Net;\r\n<span style=\"color:blue\">using</span> System.Threading;\r\n<span style=\"color:blue\">using</span> NAudio.Wave;\r\n<span style=\"color:blue\">using</span> NAudio.CoreAudioApi;\r\n<span style=\"color:blue\">using</span> System.IO;\r\n\r\n<span style=\"color:blue\">namespace</span> 廣播系統\r\n{\r\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">partial</span> <span style=\"color:blue\">class</span> Form1 : Form\r\n    {\r\n        <span style=\"color:blue\">private</span> Thread mListenThread;\r\n        <span style=\"color:blue\">private</span> IPEndPoint sIpEnd;\r\n        <span style=\"color:blue\">private</span> Socket server;\r\n        <span style=\"color:blue\">private</span> WaveIn wavein;\r\n        <span style=\"color:blue\">private</span> WaveOut waveout;\r\n        <span style=\"color:blue\">private</span> <span style=\"color:blue\">static</span> BufferedWaveProvider wavProv;\r\n        <span style=\"color:blue\">public</span> Form1()\r\n        {\r\n            InitializeComponent();\r\n\r\n            wavein = <span style=\"color:blue\">new</span> WaveIn();\r\n            wavein.WaveFormat = <span style=\"color:blue\">new</span> WaveFormat(8000, 16, 1);\r\n\r\n            wavein.DataAvailable &#43;= <span style=\"color:blue\">new</span> EventHandler&lt;WaveInEventArgs&gt;(Recorded);\r\n            waveout = <span style=\"color:blue\">new</span> WaveOut();\r\n            wavProv = <span style=\"color:blue\">new</span> BufferedWaveProvider(<span style=\"color:blue\">new</span> WaveFormat(8000, 16, 1));\r\n            \r\n            waveout.Init(wavProv);\r\n            \r\n            mListenThread = <span style=\"color:blue\">new</span> Thread(<span style=\"color:blue\">new</span> ParameterizedThreadStart(startListen));\r\n            mListenThread.Start();\r\n            server = <span style=\"color:blue\">new</span> Socket(AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp);\r\n        }\r\n\r\n        <span style=\"color:blue\">private</span> <span style=\"color:blue\">void</span> button1_Click(<span style=\"color:blue\">object</span> sender, EventArgs e)\r\n        {\r\n            <span style=\"color:green\">// Start Record</span>\r\n            \r\n            wavein.StartRecording();\r\n            \r\n        }\r\n        <span style=\"color:blue\">private</span> <span style=\"color:blue\">void</span> Recorded(<span style=\"color:blue\">object</span> sender, WaveInEventArgs e)\r\n        {\r\n            <span style=\"color:blue\">try</span>\r\n            {\r\n                \r\n                IPEndPoint cIpEnd = <span style=\"color:blue\">new</span> IPEndPoint(IPAddress.Parse(<span style=\"color:#a31515\">&quot;127.0.0.1&quot;</span>), 12131);\r\n                server.SendTo(e.Buffer, cIpEnd);\r\n                \r\n                \r\n            }\r\n            <span style=\"color:blue\">catch</span> (Exception err)\r\n            {\r\n                <span style=\"color:green\">//statusBar1.Text = err.Message;</span>\r\n            }\r\n        }\r\n        <span style=\"color:blue\">private</span> <span style=\"color:blue\">void</span> startListen(<span style=\"color:blue\">object</span> sender)\r\n        {\r\n            <span style=\"color:green\">//MessageBox.Show(&quot;Thread Start&quot;);</span>\r\n            <span style=\"color:green\">// UDP Start</span>\r\n            IPEndPoint sIpEnd = <span style=\"color:blue\">new</span> IPEndPoint(IPAddress.Any, 12131);\r\n            Socket sock = <span style=\"color:blue\">new</span> Socket(AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp);\r\n            sock.Bind(sIpEnd);\r\n\r\n            IPEndPoint remoteIpEnd = <span style=\"color:blue\">new</span> IPEndPoint(IPAddress.Any, 0);\r\n            EndPoint Remote = (EndPoint)remoteIpEnd;\r\n            \r\n            \r\n            waveout.Play();\r\n            <span style=\"color:blue\">int</span> offset = 0;\r\n            <span style=\"color:blue\">while</span> (<span style=\"color:blue\">true</span>)\r\n            {\r\n                <span style=\"color:blue\">byte</span>[] data = <span style=\"color:blue\">new</span> <span style=\"color:blue\">byte</span>[65535];\r\n                <span style=\"color:blue\">int</span> recv = sock.ReceiveFrom(data, <span style=\"color:blue\">ref</span> Remote);\r\n                wavProv.AddSamples(data, offset, recv);\r\n                \r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n</pre>\r\n</div>\r\n",
    "PostedDate": "2011-01-03T00:46:20.31-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "544208",
    "ThreadId": "240244",
    "Html": "\r\n<p>there will inevitably be latency with anything like this. you are probably hearing the direct sound (check your windows mixer settings) as well as the sound received over the network.</p>\r\n",
    "PostedDate": "2011-01-05T02:36:21.78-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]