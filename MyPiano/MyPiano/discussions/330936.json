[
  {
    "Id": "783755",
    "ThreadId": "330936",
    "Html": "<p>Hi, this is 5th day that I can't solve this problem. Firstly I thought it was something with C# and .NET But know I lost all my hopes and will to live ;)</p>\n<p>I made a class - AudioManager which has ability to play and record sound. It looks something like this:</p>\n<div style=\"background-color: white; color: black;\">\n<pre><span style=\"color: blue;\">private</span> DirectSoundOut output = <span style=\"color: blue;\">null</span>;\r\n<span style=\"color: blue;\">private</span> WaveIn input = <span style=\"color: blue;\">null</span>;\r\n<span style=\"color: blue;\">private</span> WaveFileWriter waveWriter = <span style=\"color: blue;\">null</span>;\r\n<span style=\"color: blue;\">private</span> WaveFileReader waveReader = <span style=\"color: blue;\">null</span>;\r\n\r\n\r\n<span style=\"color: blue;\">public</span> <span style=\"color: blue;\">void</span> LoadFile(<span style=\"color: blue;\">string</span> fileName)\r\n{\r\n      CloseAll(); <span style=\"color: green;\">//just disposes all streams and NAudio objects, like output</span>\r\n      waveReader = <span style=\"color: blue;\">new</span> WaveFileReader(fileName);\r\n \r\n      output = <span style=\"color: blue;\">new</span> DirectSoundOut();\r\n      output.Init(<span style=\"color: blue;\">new</span> WaveChannel32(waveReader));\r\n}\r\n\r\n\r\n<span style=\"color: green;\">//plays loaded file</span>\r\n<span style=\"color: blue;\">public</span> <span style=\"color: blue;\">void</span> Play()\r\n{\r\n      <span style=\"color: blue;\">if</span> (_state == State.MONITORING) StopRecord();\r\n      <span style=\"color: blue;\">if</span> (output == <span style=\"color: blue;\">null</span>) <span style=\"color: blue;\">return</span>;\r\n      <span style=\"color: blue;\">if</span> (output.PlaybackState != PlaybackState.Playing)\r\n      {\r\n          output.Play();\r\n          _state = State.PLAYING;\r\n      }\r\n}\r\n\r\n\r\n<span style=\"color: green;\">//stops playing file</span>\r\n<span style=\"color: blue;\">public</span> <span style=\"color: blue;\">void</span> Stop()\r\n{\r\n      <span style=\"color: blue;\">if</span> (output == <span style=\"color: blue;\">null</span>) <span style=\"color: blue;\">return</span>;\r\n      <span style=\"color: blue;\">if</span> (output.PlaybackState != PlaybackState.Stopped)\r\n      {\r\n          output.Stop();\r\n          _state = State.STOPPED;\r\n      }\r\n}\r\n\r\n\r\n<span style=\"color: blue;\">public</span> WaveFileReader GetWaveReader()\r\n{\r\n      <span style=\"color: blue;\">return</span> waveReader;\r\n}\r\n</pre>\n</div>\n<p>&nbsp;</p>\n<p>Recording is fine, so I don't show it here. Anyway, after recording a file, I do some cutting in this file - simply I cut part of the wave file. This works fine also. Then I load new(cutted) file into my AudioManager, and want to show new waveform:</p>\n<div style=\"background-color: white; color: black;\">\n<pre>JuhasWaveViewer wv = GetWaveViewer(clickedIndex); <span style=\"color: green;\">//JuhasWaveViewer is standard NAudio.WaveViewer with some new features like colors and cutting</span>\r\n\r\n<span style=\"color: blue;\">string</span> filename = GetCheckedFileName(); <span style=\"color: green;\">//this filename resides in TAG property of WaveViewer</span>\r\nwv.CutSelection(filename); <span style=\"color: green;\">//cuts some part of file and saves the new file with the same name</span>\r\n\r\nam.LoadFile(filename); <span style=\"color: green;\">//loads this new file to my AudioManager</span>\r\n\r\n<span style=\"color: green;\">//now I want to draw new waveform. _ws is my private WaveStream</span>\r\nwv.WaveStream = <span style=\"color: blue;\">null</span>;\r\n_ws = <span style=\"color: blue;\">new</span> RawSourceWaveStream(am.GetWaveReader(), am.GetWaveReader().WaveFormat);\r\nwv.WaveStream = _ws;\r\n</pre>\n</div>\n<p>&nbsp;</p>\n<p>(I use _ws just for some debugging, normally I would do just: wv.WaveStream = new RawSourceWaveStream....)<br />Until now everything works and WaveViewer shows new waveform. I can resize my WaveViewer and everything works fine. But, then I want to play this new file. So I use am.Play() method. It plays - I can hear that this is the cutted file. But now, when I want to resize my waveStream or do anything else with it, it loses waveform and shows just white field with red x-like cross. I was checking the memory and found that _ws is in different place in memory than it was on the start, but wv.WaveStream still points to _ws, so they are still connected. So what is the issue? What am I doing wrong?</p>\n<p>I even tried to call Invalidate on waveViewer, but it doesn't work. Please help me</p>\n<p><strong>[EDIT]</strong></p>\n<p>I got into WaveViewer OnPaint method and the problem is connected to Position property. Here is print screen of what debugger says: <a href=\"http://img191.imageshack.us/img191/9513/erroryjg.jpg\">http://img191.imageshack.us/img191/9513/erroryjg.jpg</a></p>\n<p>(\"Object reference not set to an instance of an object.\"). What's wrong with this?</p>\n<p><strong>[EDIT2]</strong></p>\n<p>OK, having looked in source, I realised that RawSourceWaveStream is just some strange class that does nothing. I thought it would have a copy of WaveFileReader, not the WaveFileReader. And the Position property calls WaveFileReaders Position property. WHY? I tried something like that:</p>\n<div style=\"color: black; background-color: white;\">\n<pre>wv.WaveStream = <span style=\"color: blue;\">new</span> WaveFileReader(filename);\r\n\r\n</pre>\n</div>\n<p>instead of:</p>\n<div style=\"color: black; background-color: white;\">\n<pre>wv.waveStream = <span style=\"color: blue;\">new</span> RawSourceWaveStream(am.GetWaveReader(), am.GetWaveReader().WaveFormat);\r\n</pre>\n</div>\n<p>But now problem is the file which is opened exlusively by WaveFileReader. Why is that?</p>\n<p><span style=\"font-family: Consolas; font-size: x-small;\">&nbsp;</span></p>\n<p>&nbsp;</p>",
    "PostedDate": "2012-02-20T04:40:20.177-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "800487",
    "ThreadId": "330936",
    "Html": "<p>why are you using RawSourceWaveStream for a WAV file? Just use WaveFileReader. The point of it is when you have raw audio data in a stream/file but no WaveFormat info.</p>",
    "PostedDate": "2012-02-26T08:58:16.52-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]