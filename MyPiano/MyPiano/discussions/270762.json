[
  {
    "Id": "664806",
    "ThreadId": "270762",
    "Html": "<p>Hi,</p>\n<p>For a project where I need to analyze audio (FFT, DTMF decoding, ...) I need to extract the samples from a WAV file.</p>\n<p>What I exactly need is an array of double (or a C# List ...) so I can work on the samples.</p>\n<p>More (or better!) I would like to convert the input WAV file so the format of the array is always the same (Let's consider 8kHz).</p>\n<p>Here is what I already was able to do:</p>\n<p>&nbsp;</p>\n<div style=\"color: black; background-color: white;\">\n<pre>WaveFileReader wfr = <span style=\"color: blue;\">new</span> WaveFileReader(filename);\r\nWaveStream ws = WaveFormatConversionStream.CreatePcmStream(wfr);\r\n\r\nWaveStream blockAlignedStream = <span style=\"color: blue;\">new</span> BlockAlignReductionStream(ws);\r\nWaveChannel32 waveChannel = <span style=\"color: blue;\">new</span> WaveChannel32(blockAlignedStream);\r\n\r\nWaveFormat format = <span style=\"color: blue;\">new</span> WaveFormat(waveChannel.WaveFormat.SampleRate, waveChannel.WaveFormat.BitsPerSample, waveChannel.WaveFormat.Channels);\r\n<span style=\"color: blue;\">byte</span>[] buffer1 = <span style=\"color: blue;\">new</span> <span style=\"color: blue;\">byte</span>[waveChannel.WaveFormat.SampleRate];\r\n\r\n<span style=\"color: blue;\">int</span> bytesRead;\r\n<span style=\"color: blue;\">while</span> (waveChannel.Position &lt; waveChannel.Length)\r\n{\r\n    bytesRead = waveChannel.Read(buffer1, 0, waveChannel.WaveFormat.SampleRate);\r\n\r\n\r\n    // ... there I'm lost !<br />}\r\n\r\n\r\n\r\nThem, now, how could I convert the bytes to the array of double?<br />Is there another class to do that?<br /><br />Thanks for helping<br />Fred<br /><br /></pre>\n</div>",
    "PostedDate": "2011-08-29T06:03:43.32-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "675360",
    "ThreadId": "270762",
    "Html": "<p>have a look at the code inside WaveChannel32 and you will see how it reads in the 16 bit audio and converts it to floats.</p>\r\n<p>Mark</p>",
    "PostedDate": "2011-09-22T08:52:04.033-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "675649",
    "ThreadId": "270762",
    "Html": "<p>Hello markheath,</p>\r\n<p>Sorry, I was not really able to understand how to do that in your code.</p>\r\n<p>However, I have finally found a solution; here it is, for those who might need it:</p>\r\n<p>&nbsp;</p>\r\n<p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">using</span> (WaveFileReader wfr = <span style=\"color: blue;\">new</span> WaveFileReader(m_filename))\r\n{\r\n<span style=\"color: blue;\">  using</span> (WaveStream ws = WaveFormatConversionStream.CreatePcmStream(wfr))\r\n  {\r\n<span style=\"color: blue;\">    using</span> (WaveStream baStream = <span style=\"color: blue;\">new</span> BlockAlignReductionStream(ws))\r\n    {\r\n      WaveFormat format = <span style=\"color: blue;\">new</span> WaveFormat(baStream.WaveFormat.SampleRate, baStream.WaveFormat.BitsPerSample, baStream.WaveFormat.Channels);\r\n      <span style=\"color: blue;\">byte</span>[] buffer1 = <span style=\"color: blue;\">new</span> <span style=\"color: blue;\">byte</span>[baStream.WaveFormat.BitsPerSample / 8];\r\n\r\n      SampleRate = baStream.WaveFormat.SampleRate;\r\n      wavFormat = baStream.WaveFormat;\r\n\r\n      <span style=\"color: blue;\">int</span> bytesRead = 0;\r\n      <span style=\"color: blue;\">long</span> previousPosition = 0;\r\n      List&lt;<span style=\"color: blue;\">double</span>&gt; lst = <span style=\"color: blue;\">new</span> List&lt;<span style=\"color: blue;\">double</span>&gt;();\r\n      <span style=\"color: blue;\">double</span> currentValue;\r\n      <span style=\"color: blue;\">double</span> avg = 0;\r\n      <span style=\"color: blue;\">while</span> (baStream.Position &lt; baStream.Length)\r\n      {\r\n        bytesRead = baStream.Read(buffer1, 0, baStream.WaveFormat.BitsPerSample / 8);\r\n\r\n        <span style=\"color: blue;\">if</span> (wfr.WaveFormat.Channels &gt; 1 &amp;&amp; rdbReadTrack2.Checked == <span style=\"color: blue;\">true</span>) <span style=\"color: green;\">// Use 2nd channel</span>\r\n          bytesRead = baStream.Read(buffer1, 0, baStream.WaveFormat.BitsPerSample / 8);\r\n\r\n        <span style=\"color: blue;\">if</span> (baStream.WaveFormat.BitsPerSample / 8 &gt; 1)\r\n        {\r\n          currentValue = 100.0 * BitConverter.ToInt16(buffer1, 0) / <span style=\"color: blue;\">short</span>.MaxValue;\r\n        }\r\n        <span style=\"color: blue;\">else</span> <span style=\"color: green;\">// Special case for 8 bit signal</span>\r\n        {\r\n          currentValue = 100.0 * 255 * (buffer1[0] - 128) / <span style=\"color: blue;\">short</span>.MaxValue;\r\n        }\r\n        lst.Add(currentValue);\r\n        avg += currentValue;\r\n\r\n        <span style=\"color: blue;\">if</span> (wfr.WaveFormat.Channels &gt; 1 &amp;&amp; rdbReadTrack1.Checked == <span style=\"color: blue;\">true</span>) <span style=\"color: green;\">// Skip 2nd channel</span>\r\n          bytesRead = baStream.Read(buffer1, 0, baStream.WaveFormat.BitsPerSample / 8);\r\n      }\r\n\r\n      avg /= baStream.Length;\r\n\r\n      // ... Now lst contain the data I need!<br />   &nbsp;}\r\n  }<br />}\r\n</pre>\r\n</div>\r\n</p>\r\n<p>Best regards,</p>\r\n<p>Fred</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-09-22T23:13:37.063-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]