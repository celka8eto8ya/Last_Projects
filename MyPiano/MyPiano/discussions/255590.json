[
  {
    "Id": "604265",
    "ThreadId": "255590",
    "Html": "\r\n<p>I am getting unhanded exceptions from the NAudio.dll while decoding MP3's&nbsp; This is random and the MP3 files that it breaks on are not corrupt.</p>\r\n<p>If i recall its dealing with a read next byte out of range index something for decoding an MP3.</p>\r\n<p>Im running my application right now trying to have this raised again.</p>\r\n<p>The NAudio.dll was built from the latest source because the 1.4 dll was doing the same thing but even more often.</p>\r\n<p>&nbsp;</p>\r\n<p>Im about to add the project directly into my solution so i can have an exact line where its raised as well but if any one knows why this is happening i would appreciate it.</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks</p>\r\n<p>-Largo Usagi</p>\r\n",
    "PostedDate": "2011-04-28T10:16:51.883-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "604338",
    "ThreadId": "255590",
    "Html": "<p>if you could test against the code that would be great. there might be an edge case that the MP3 frame parser is not dealing with</p>",
    "PostedDate": "2011-04-28T12:00:49.903-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "604487",
    "ThreadId": "255590",
    "Html": "<p>A first chance exception of type 'System.FormatException' occurred in NAudio.dll<br />A first chance exception of type 'System.IO.EndOfStreamException' occurred in mscorlib.dll<br />A first chance exception of type 'System.IO.EndOfStreamException' occurred in mscorlib.dll<br />System.Transactions Critical: 0 : &lt;TraceRecord xmlns=\"http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord\" Severity=\"Critical\"&gt;&lt;TraceIdentifier&gt;http://msdn.microsoft.com/TraceCodes/System/ActivityTracing/2004/07/Reliability/Exception/Unhandled&lt;/TraceIdentifier&gt;&lt;Description&gt;Unhandled exception&lt;/Description&gt;&lt;AppDomain&gt;CerberusLanJukeboxDeamon.vshost.exe&lt;/AppDomain&gt;&lt;Exception&gt;&lt;ExceptionType&gt;System.IO.EndOfStreamException, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/ExceptionType&gt;&lt;Message&gt;Unable to read beyond the end of the stream.&lt;/Message&gt;&lt;StackTrace&gt;&nbsp;&nbsp; at System.IO.BinaryReader.ReadByte()<br />&nbsp;&nbsp; at NAudio.Wave.Mp3Frame..ctor(Stream input, Boolean readData)<br />&nbsp;&nbsp; at NAudio.Wave.Mp3FileReader.ReadNextFrame(Boolean readData)<br />&nbsp;&nbsp; at NAudio.Wave.Mp3FileReader.ReadNextFrame()<br />&nbsp;&nbsp; at NAudio.Wave.Mp3FileReader.Read(Byte[] sampleBuffer, Int32 offset, Int32 numBytes)<br />&nbsp;&nbsp; at NAudio.Wave.SampleProviders.Stereo16SampleProvider.LoadNextChunk(IWaveProvider source, Int32 samplePairsRequired)<br />&nbsp;&nbsp; at NAudio.Wave.WaveChannel32.Read(Byte[] destBuffer, Int32 offset, Int32 numBytes)<br />&nbsp;&nbsp; at NAudio.Wave.WaveOutBuffer.OnDone()<br />&nbsp;&nbsp; at NAudio.Wave.WaveOut.Callback(IntPtr hWaveOut, WaveMessage uMsg, IntPtr dwInstance, WaveHeader wavhdr, IntPtr dwReserved)&lt;/StackTrace&gt;&lt;ExceptionString&gt;System.IO.EndOfStreamException: Unable to read beyond the end of the stream.<br />&nbsp;&nbsp; at System.IO.BinaryReader.ReadByte()<br />&nbsp;&nbsp; at NAudio.Wave.Mp3Frame..ctor(Stream input, Boolean readData)<br />&nbsp;&nbsp; at NAudio.Wave.Mp3FileReader.ReadNextFrame(Boolean readData)<br />&nbsp;&nbsp; at NAudio.Wave.Mp3FileReader.ReadNextFrame()<br />&nbsp;&nbsp; at NAudio.Wave.Mp3FileReader.Read(Byte[] sampleBuffer, Int32 offset, Int32 numBytes)<br />&nbsp;&nbsp; at NAudio.Wave.SampleProviders.Stereo16SampleProvider.LoadNextChunk(IWaveProvider source, Int32 samplePairsRequired)<br />&nbsp;&nbsp; at NAudio.Wave.WaveChannel32.Read(Byte[] destBuffer, Int32 offset, Int32 numBytes)<br />&nbsp;&nbsp; at NAudio.Wave.WaveOutBuffer.OnDone()<br />&nbsp;&nbsp; at NAudio.Wave.WaveOut.Callback(IntPtr hWaveOut, WaveMessage uMsg, IntPtr dwInstance, WaveHeader wavhdr, IntPtr dwReserved)&lt;/ExceptionString&gt;&lt;/Exception&gt;&lt;/TraceRecord&gt;<br />An unhandled exception of type 'System.IO.EndOfStreamException' occurred in mscorlib.dll<br /><br />Additional information: Unable to read beyond the end of the stream.</p>\r\n<p>&nbsp;</p>\r\n<p>this is the dissasembly</p>\r\n<p>&nbsp;</p>\r\n<p>00000000&nbsp; push&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ebp <br />00000001&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ebp,esp <br />00000003&nbsp; push&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; esi <br />00000004&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; esi,ecx <br />00000006&nbsp; cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dword ptr [esi+4],0 <br />0000000a&nbsp; je&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0092BC08 <br />00000010&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ecx,dword ptr [esi+4] <br />00000013&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eax,dword ptr [ecx] <br />00000015&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eax,dword ptr [eax+34h] <br />00000018&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dword ptr [eax+18h] <br />0000001b&nbsp; cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eax,0FFFFFFFFh <br />0000001e&nbsp; je&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0092BC21 <br />00000024&nbsp; and&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eax,0FFh <br />00000029&nbsp; pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; esi <br />0000002a&nbsp; pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ebp <br />0000002b&nbsp; ret <br />0000002c&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FFC8D820 <br />00000031&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ecx,dword ptr [esi+4] <br />00000034&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eax,dword ptr [ecx] <br />00000036&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eax,dword ptr [eax+34h] <br />00000039&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dword ptr [eax+18h] <br />0000003c&nbsp; cmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eax,0FFFFFFFFh <br />0000003f&nbsp; jne&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FF6D4448 <br />00000045&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ecx,6C99302Ch <br />0000004a&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FF66C644 <br />0000004f&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; esi,eax <br />00000051&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; edx,6C681000h <br />00000056&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ecx,70019429h <br />0000005b&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FF66C6C4 <br />00000060&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ecx,eax <br />00000062&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FF66DA4C <br />00000067&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; edx,eax <br />00000069&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ecx,esi <br />0000006b&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FFDCA51C <br />00000070&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ecx,esi <br />00000072&nbsp; call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FF66C6CC <br />00000077&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3</p>\r\n<p>Call stack location of mscorlib.dll!System.IO.BinaryReader.ReadByte() + 0x77 bytes</p>",
    "PostedDate": "2011-04-28T15:04:35.94-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "604685",
    "ThreadId": "255590",
    "Html": "<p>are you able to share the MP3?</p>",
    "PostedDate": "2011-04-29T01:23:51.583-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "604924",
    "ThreadId": "255590",
    "Html": "<p>Yah i can run the application again until it its an MP3 that does this to it.</p>\r\n<p>&nbsp;</p>\r\n<p>I also got a new error in stress testing</p>\r\n<p>Destination array was not long enough check destIndex and length, and the array's lower bounds.</p>\r\n<p>&nbsp;</p>\r\n<p>This is the function that the related call was made under</p>\r\n<p>&nbsp;</p>\r\n<p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">public</span> <span style=\"color: blue;\">bool</span> Play()\r\n        {\r\n            <span style=\"color: blue;\">if</span> (!IsPlaying)\r\n            {\r\n                <span style=\"color: blue;\">if</span> (fileSet)\r\n                {\r\n                    <span style=\"color: blue;\">try</span>\r\n                    {\r\n                        waveOutDevice.Init(mainOutputStream);\r\n                        waveOutDevice.Play();\r\n                        Console.WriteLine(<span style=\"color: #a31515;\">\"Playing: \"</span> + mp3File);\r\n                        <span style=\"color: blue;\">if</span> (SongPlayed != <span style=\"color: blue;\">null</span>) SongPlayed(<span style=\"color: blue;\">this</span>);\r\n                        <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">true</span>;\r\n                    }\r\n                    <span style=\"color: blue;\">catch</span> (Exception e)\r\n                    {\r\n                        Console.WriteLine(<span style=\"color: #a31515;\">\"Error Playing: \"</span> + e.Message);\r\n                        <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n                    }\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    Console.WriteLine(<span style=\"color: #a31515;\">\"You need to set a file before trying to play one\"</span>);\r\n                    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n                }\r\n            }\r\n            <span style=\"color: blue;\">else</span>\r\n            {\r\n                Console.WriteLine(<span style=\"color: #a31515;\">\"Allready playing file\"</span>);\r\n                <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n            }\r\n        }\r\n</pre>\r\n</div>\r\n</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>and for the betterment because hell maybe im using this wrong here is the mp3 player class i have written thus far</p>\r\n<p>&nbsp;</p>\r\n<p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">using</span> System;\r\n<span style=\"color: blue;\">using</span> System.Collections;\r\n<span style=\"color: blue;\">using</span> System.Collections.Generic;\r\n<span style=\"color: blue;\">using</span> System.Linq;\r\n<span style=\"color: blue;\">using</span> System.Text;\r\n<span style=\"color: blue;\">using</span> System.Timers;\r\n<span style=\"color: blue;\">using</span> NAudio;\r\n<span style=\"color: blue;\">using</span> NAudio.Wave;\r\n<span style=\"color: blue;\">using</span> NAudio.CoreAudioApi;\r\n\r\n<span style=\"color: blue;\">namespace</span> JukeboxLib\r\n{\r\n    <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">class</span> MP3Player\r\n    {\r\n\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">delegate</span> <span style=\"color: blue;\">void</span> PlayerEvents(<span style=\"color: blue;\">object</span> sender);\r\n\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">event</span> PlayerEvents PlaybackFinished;\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">event</span> PlayerEvents SongSkipped;\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">event</span> PlayerEvents SongStopped;\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">event</span> PlayerEvents SongPaused;\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">event</span> PlayerEvents SongPlayed;\r\n\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">event</span> PlayerEvents OutputChanged;\r\n\r\n        <span style=\"color: blue;\">private</span> IWavePlayer waveOutDevice;\r\n        <span style=\"color: blue;\">private</span> WaveStream mainOutputStream;\r\n        <span style=\"color: blue;\">private</span> WaveChannel32 volumeStream;\r\n        <span style=\"color: blue;\">private</span> Timer updateTimer;\r\n\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">float</span> precentThrough;\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">int</span> outputDevice;\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">bool</span> fileSet;\r\n        <span style=\"color: blue;\">private</span> String mp3File;\r\n        <span style=\"color: blue;\">private</span> ArrayList outputDevices;\r\n\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;summary&gt;</span>\r\n        <span style=\"color: gray;\">///</span><span style=\"color: green;\"> Is the MP3 Player Currently Playing a Song</span>\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;/summary&gt;</span>\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">bool</span> IsPlaying\r\n        {\r\n            <span style=\"color: blue;\">get</span>\r\n            {\r\n                <span style=\"color: blue;\">if</span> (waveOutDevice.PlaybackState == PlaybackState.Playing)\r\n                {\r\n                    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">true</span>;\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n                }\r\n            }\r\n        }\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;summary&gt;</span>\r\n        <span style=\"color: gray;\">///</span><span style=\"color: green;\"> Is the MP3 player paused during playback</span>\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;/summary&gt;</span>\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">bool</span> IsPaused\r\n        {\r\n            <span style=\"color: blue;\">get</span>\r\n            {\r\n                <span style=\"color: blue;\">if</span> (waveOutDevice.PlaybackState == PlaybackState.Paused)\r\n                {\r\n                    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">true</span>;\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n                }\r\n            }\r\n        }\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;summary&gt;</span>\r\n        <span style=\"color: gray;\">///</span><span style=\"color: green;\"> Is the MP3 Player stopped</span>\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;/summary&gt;</span>\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">bool</span> IsStopped\r\n        {\r\n            <span style=\"color: blue;\">get</span>\r\n            {\r\n                <span style=\"color: blue;\">if</span> (waveOutDevice.PlaybackState == PlaybackState.Stopped)\r\n                {\r\n                    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">true</span>;\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n                }\r\n            }\r\n        }\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;summary&gt;</span>\r\n        <span style=\"color: gray;\">///</span><span style=\"color: green;\"> Get or Set the output device</span>\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;/summary&gt;</span>\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">int</span> OutputDevice\r\n        {\r\n            <span style=\"color: blue;\">get</span>\r\n            {\r\n                <span style=\"color: blue;\">return</span> outputDevice;\r\n            }\r\n            <span style=\"color: blue;\">set</span>\r\n            {\r\n                <span style=\"color: blue;\">if</span> (value &lt;= WaveOut.DeviceCount)\r\n                {\r\n                    <span style=\"color: blue;\">float</span> vol = waveOutDevice.Volume;\r\n                    outputDevice = value;\r\n                    <span style=\"color: blue;\">if</span> (IsPlaying)\r\n                    {\r\n                        Pause();\r\n                    }\r\n                    createWavePlayer();\r\n                    waveOutDevice.Volume = vol;\r\n                    Play();\r\n                    OutputChanged(<span style=\"color: blue;\">this</span>);\r\n                }\r\n            }\r\n        }\r\n\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;summary&gt;</span>\r\n        <span style=\"color: gray;\">///</span><span style=\"color: green;\"> The current playback state of the MP3 Player</span>\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;/summary&gt;</span>\r\n        <span style=\"color: blue;\">public</span> PlaybackState PlayerState\r\n        {\r\n            <span style=\"color: blue;\">get</span>\r\n            {\r\n                <span style=\"color: blue;\">if</span> (waveOutDevice != <span style=\"color: blue;\">null</span>)\r\n                {\r\n                    <span style=\"color: blue;\">return</span> waveOutDevice.PlaybackState;\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    Console.WriteLine(<span style=\"color: #a31515;\">\"Playstate is stopped because it hasnt been initialzed\"</span>);\r\n                    <span style=\"color: blue;\">return</span> PlaybackState.Stopped;\r\n                }\r\n            }\r\n        }\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;summary&gt;</span>\r\n        <span style=\"color: gray;\">///</span><span style=\"color: green;\"> The location of the file loaded to the MP3 player</span>\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;/summary&gt;</span>\r\n        <span style=\"color: blue;\">public</span> String MP3File\r\n        {\r\n            <span style=\"color: blue;\">get</span>\r\n            {\r\n                <span style=\"color: blue;\">return</span> mp3File;\r\n            }\r\n            <span style=\"color: blue;\">set</span>\r\n            {\r\n                mp3File = value;\r\n                <span style=\"color: blue;\">if</span> (value != <span style=\"color: blue;\">null</span>)\r\n                {\r\n                    fileSet = <span style=\"color: blue;\">true</span>;\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    fileSet = <span style=\"color: blue;\">false</span>;\r\n                }\r\n                mainOutputStream = CreateInputStream(mp3File);\r\n            }\r\n        }\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;summary&gt;</span>\r\n        <span style=\"color: gray;\">///</span><span style=\"color: green;\"> Volume where 1.0 = 100% and .01 = 1%</span>\r\n        <span style=\"color: gray;\">///</span> <span style=\"color: gray;\">&lt;/summary&gt;</span>\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">float</span> Volume\r\n        {\r\n            <span style=\"color: blue;\">get</span>\r\n            {\r\n                <span style=\"color: blue;\">return</span> waveOutDevice.Volume;\r\n            }\r\n            <span style=\"color: blue;\">set</span>\r\n            {\r\n                <span style=\"color: blue;\">if</span> (value &lt;= 1.0f)\r\n                {\r\n                    waveOutDevice.Volume = value;\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    waveOutDevice.Volume = 1.0f;\r\n                }\r\n            }\r\n        }\r\n\r\n        <span style=\"color: blue;\">public</span> MP3Player()\r\n        {\r\n            setDefaults();\r\n        }\r\n\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">void</span> setDefaults()\r\n        {\r\n            outputDevices = <span style=\"color: blue;\">new</span> ArrayList();\r\n\r\n            <span style=\"color: blue;\">for</span> (<span style=\"color: blue;\">int</span> deviceId = 0; deviceId &lt; WaveOut.DeviceCount; deviceId++)\r\n            {\r\n                <span style=\"color: blue;\">var</span> capabilities = WaveOut.GetCapabilities(deviceId);\r\n                outputDevices.Add(String.Format(<span style=\"color: #a31515;\">\"Device {0} ({1})\"</span>, deviceId, capabilities.ProductName));\r\n            }\r\n            <span style=\"color: blue;\">for</span> (<span style=\"color: blue;\">int</span> x = 0; x &lt; outputDevices.Count; x++)\r\n            {\r\n                Console.WriteLine(outputDevices[x].ToString());\r\n            }\r\n\r\n            createWavePlayer();\r\n\r\n            fileSet = <span style=\"color: blue;\">false</span>;\r\n            precentThrough = 0.0f;\r\n\r\n            updateTimer = <span style=\"color: blue;\">new</span> Timer(500);\r\n            updateTimer.Elapsed += <span style=\"color: blue;\">new</span> ElapsedEventHandler(updateTimer_Elapsed);\r\n            updateTimer.Start();\r\n        }\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">void</span> createWavePlayer()\r\n        {\r\n            WaveOut derp = <span style=\"color: blue;\">new</span> WaveOut(WaveCallbackInfo.FunctionCallback());\r\n            derp.DesiredLatency = 200;\r\n            derp.DeviceNumber = outputDevice;\r\n            waveOutDevice = derp;\r\n\r\n            waveOutDevice.PlaybackStopped += <span style=\"color: blue;\">new</span> EventHandler(waveOutDevice_PlaybackStopped);\r\n        }\r\n\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">void</span> updateTimer_Elapsed(<span style=\"color: blue;\">object</span> sender, ElapsedEventArgs e)\r\n        {\r\n            <span style=\"color: blue;\">if</span> (waveOutDevice != <span style=\"color: blue;\">null</span> &amp;&amp; mainOutputStream != <span style=\"color: blue;\">null</span>)\r\n            {\r\n                TimeSpan currentTime = mainOutputStream.CurrentTime;\r\n                <span style=\"color: blue;\">if</span> (mainOutputStream.Position &gt;= mainOutputStream.Length)\r\n                {\r\n                    waveOutDevice.Stop();\r\n                    PlaybackFinished(<span style=\"color: blue;\">this</span>);\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    precentThrough = mainOutputStream.Position / mainOutputStream.Length;\r\n                }\r\n            }\r\n        }\r\n        <span style=\"color: blue;\">private</span> <span style=\"color: blue;\">void</span> waveOutDevice_PlaybackStopped(<span style=\"color: blue;\">object</span> sender, EventArgs e)\r\n        {\r\n            <span style=\"color: blue;\">if</span> (PlaybackFinished != <span style=\"color: blue;\">null</span>) PlaybackFinished(<span style=\"color: blue;\">this</span>);\r\n        }\r\n\r\n        <span style=\"color: blue;\">private</span> WaveStream CreateInputStream(<span style=\"color: blue;\">string</span> fileName)\r\n        {\r\n            <span style=\"color: blue;\">try</span>\r\n            {\r\n                WaveChannel32 inputStream;\r\n                <span style=\"color: blue;\">if</span> (fileName.ToLower().EndsWith(<span style=\"color: #a31515;\">\".mp3\"</span>))\r\n                {\r\n                    WaveStream mp3Reader = <span style=\"color: blue;\">new</span> Mp3FileReader(fileName);\r\n                    inputStream = <span style=\"color: blue;\">new</span> WaveChannel32(mp3Reader);\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    <span style=\"color: blue;\">throw</span> <span style=\"color: blue;\">new</span> InvalidOperationException(<span style=\"color: #a31515;\">\"Unsupported extension\"</span>);\r\n                }\r\n                volumeStream = inputStream;\r\n                <span style=\"color: blue;\">return</span> volumeStream;\r\n            }\r\n            <span style=\"color: blue;\">catch</span>(Exception ee)\r\n            {\r\n                Console.WriteLine(<span style=\"color: #a31515;\">\"Error creating inputstream\"</span>);\r\n                Console.WriteLine(ee.Message);\r\n                <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">null</span>;\r\n            }\r\n            <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">null</span>;\r\n        }\r\n\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">void</span> ThreadStartPlay()\r\n        {\r\n            Play();\r\n        }\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">bool</span> Play()\r\n        {\r\n            <span style=\"color: blue;\">if</span> (!IsPlaying)\r\n            {\r\n                <span style=\"color: blue;\">if</span> (fileSet)\r\n                {\r\n                    <span style=\"color: blue;\">try</span>\r\n                    {\r\n                        waveOutDevice.Init(mainOutputStream);\r\n                        waveOutDevice.Play();\r\n                        Console.WriteLine(<span style=\"color: #a31515;\">\"Playing: \"</span> + mp3File);\r\n                        <span style=\"color: blue;\">if</span> (SongPlayed != <span style=\"color: blue;\">null</span>) SongPlayed(<span style=\"color: blue;\">this</span>);\r\n                        <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">true</span>;\r\n                    }\r\n                    <span style=\"color: blue;\">catch</span> (Exception e)\r\n                    {\r\n                        Console.WriteLine(<span style=\"color: #a31515;\">\"Error Playing: \"</span> + e.Message);\r\n                        <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n                    }\r\n                }\r\n                <span style=\"color: blue;\">else</span>\r\n                {\r\n                    Console.WriteLine(<span style=\"color: #a31515;\">\"You need to set a file before trying to play one\"</span>);\r\n                    <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n                }\r\n            }\r\n            <span style=\"color: blue;\">else</span>\r\n            {\r\n                Console.WriteLine(<span style=\"color: #a31515;\">\"Allready playing file\"</span>);\r\n                <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n            }\r\n        }\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">bool</span> Pause()\r\n        {\r\n            <span style=\"color: blue;\">if</span> (IsPaused)\r\n            {\r\n                Play();\r\n            }\r\n            <span style=\"color: blue;\">else</span>\r\n            {\r\n                waveOutDevice.Pause();\r\n                <span style=\"color: blue;\">if</span> (SongPaused != <span style=\"color: blue;\">null</span>) SongPaused(<span style=\"color: blue;\">this</span>);\r\n            }\r\n            <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">true</span>;\r\n        }\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">bool</span> Stop()\r\n        {\r\n            <span style=\"color: blue;\">if</span> (!IsStopped)\r\n            {\r\n                waveOutDevice.Stop();\r\n                mainOutputStream = CreateInputStream(mp3File);\r\n                <span style=\"color: blue;\">if</span> (SongStopped != <span style=\"color: blue;\">null</span>) SongStopped(<span style=\"color: blue;\">this</span>);\r\n                <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">true</span>;\r\n            }\r\n            <span style=\"color: blue;\">else</span>\r\n            {\r\n                <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">false</span>;\r\n            }\r\n        }\r\n        <span style=\"color: blue;\">public</span> <span style=\"color: blue;\">bool</span> Skip()\r\n        {\r\n            waveOutDevice.Stop();\r\n            mainOutputStream = <span style=\"color: blue;\">null</span>;\r\n            <span style=\"color: blue;\">if</span> (SongSkipped != <span style=\"color: blue;\">null</span>) SongSkipped(<span style=\"color: blue;\">this</span>);\r\n            <span style=\"color: blue;\">return</span> <span style=\"color: blue;\">true</span>;\r\n        }\r\n\r\n    }\r\n}\r\n\r\n</pre>\r\n</div>\r\n</p>",
    "PostedDate": "2011-04-29T09:22:42.883-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "605397",
    "ThreadId": "255590",
    "Html": "<p>https://rapidshare.com/files/460017756/thows_exception.mp3</p>\r\n<p>Here is an mp3 that raises an exception</p>",
    "PostedDate": "2011-04-30T19:41:40.417-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "606091",
    "ThreadId": "255590",
    "Html": "<p>thanks for the link. I will test with the file and report back if I can find what is wrong.</p>\r\n<p>Mark</p>",
    "PostedDate": "2011-05-02T13:27:59.487-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "608904",
    "ThreadId": "255590",
    "Html": "<p>OK, it's just getting to the end of file sooner than expected. I'll probably update future versions of NAudio to just ignore that kind of error with MP3 playback.</p>",
    "PostedDate": "2011-05-07T03:00:21.82-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "608936",
    "ThreadId": "255590",
    "Html": "<p>Is this something that will be revision i can download and build from source, this is the only error keeping me from using this in an application.&nbsp; I would like to be using this very soon as well.</p>\r\n<p>&nbsp;</p>\r\n<p>Any ways thanks for looking over this and i cant wait to see this get patched, i have found about 50 or so MP3's that do that, the dll is being tested against over 30k mp3's so any other errors i find i will pass on to you.</p>\r\n<p>&nbsp;</p>\r\n<p>-Largo Usagi</p>",
    "PostedDate": "2011-05-07T05:54:59.543-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "609013",
    "ThreadId": "255590",
    "Html": "<p>hi largo, can you test with the latest in souce control? I have made a bunch of refactoring improvements (more to follow)</p>",
    "PostedDate": "2011-05-07T12:40:57.623-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "609045",
    "ThreadId": "255590",
    "Html": "<p>Hell yah i can,</p>\r\n<p>Ill get on this in the next few hours here, and have something posted back within 48 hours (probably tomorrow though)</p>",
    "PostedDate": "2011-05-07T17:45:23.517-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "689250",
    "ThreadId": "255590",
    "Html": "<p>Does anyone know if this is resolved. We are getting the same problem here, very random.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>Thx</p>",
    "PostedDate": "2011-10-25T13:30:47.813-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "689251",
    "ThreadId": "255590",
    "Html": "<p>Does anyone know if this is resolved. We are getting the same problem here, very random.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>Thx</p>",
    "PostedDate": "2011-10-25T13:30:48.753-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "689252",
    "ThreadId": "255590",
    "Html": "<p>Just a note the issue is coming from streams off of pandora.&nbsp;</p>",
    "PostedDate": "2011-10-25T13:31:28.96-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "689498",
    "ThreadId": "255590",
    "Html": "<p>@EvanW - are you using the latest code from Source Control?</p>",
    "PostedDate": "2011-10-26T02:50:58.68-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "689610",
    "ThreadId": "255590",
    "Html": "<p>I am using the latest release. Is the issue fixed in Source ? Is there a version in source control you consider production stable that I can get ?</p>\r\n<p>Thanks !!</p>",
    "PostedDate": "2011-10-26T06:55:41.847-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "689612",
    "ThreadId": "255590",
    "Html": "<p>Well I don't know exactly what issue you are seeing, so I can't say if it is fixed. The latest version is source code is more stable than 1.4 was, and will probably only get minor tweaks before 1.5 is released</p>",
    "PostedDate": "2011-10-26T06:57:28.577-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "689620",
    "ThreadId": "255590",
    "Html": "<p>The exact issue is randomly&nbsp;PlaybackStopped on interface&nbsp;IWavePlayer created using&nbsp;DirectSoundOut just fires before the audio is played. This happens I'd say 10% of the time. &nbsp;These are 128K mp3 streams. It would be a none issue but pandoras workflow opens a new stream per song and it's&nbsp;noticeable&nbsp;when it happens.&nbsp;</p>\r\n<p>If you think getting the latest version will help , I'll give it a go .&nbsp;</p>\r\n<p>Thx</p>",
    "PostedDate": "2011-10-26T07:07:20.193-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "690584",
    "ThreadId": "255590",
    "Html": "<p>Got the latest source, samples wont build and the Mp3Frame.StreamEnded isn't defined anymore. Any advice ? Really want to use this library but we're still&nbsp;experiencing&nbsp;studdering&nbsp;occasionally&nbsp;and that is going to make problems when we go to production.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>Thx</p>\r\n<p>&nbsp;</p>\r\n<p>Evan</p>",
    "PostedDate": "2011-10-27T19:02:39.15-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "692221",
    "ThreadId": "255590",
    "Html": "<p>what build errors are you getting?</p>",
    "PostedDate": "2011-11-01T09:23:42.327-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "692226",
    "ThreadId": "255590",
    "Html": "<p>Apologies for not updating this thread , it was a visual studio thing. &nbsp;</p>",
    "PostedDate": "2011-11-01T09:32:26.717-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]