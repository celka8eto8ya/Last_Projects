[
  {
    "Id": "273007",
    "ThreadId": "79718",
    "Html": "<p>&nbsp;</p>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">I'm trying to use NAudio in WPF, but I have one big problem. I use AudioPlayback (WaveOut playback device) class from NAudioWpfDemo sample project and everything works well with first sound file, but when I try to load and play next sound I've received a NullReferenceException. The same problem is with original NAudioWpfDemo project. I suppose that the problem is with handling messages from WaveOut, but I don't know how to handle them in WPF. I tried this:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">private void Window_Loaded(object sender, RoutedEventArgs e)</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">{</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>IntPtr hwnd = new WindowInteropHelper(this).Handle;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>HwndSource.FromHwnd(hwnd).AddHook(new HwndSourceHook(WndProc));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">private static IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">{</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;if (msg &gt;= 0x3BB &amp;&amp; msg &lt;= 0x3C0)</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>{</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int x = 0;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;<span style=\"white-space:pre\"> </span>x++;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>return IntPtr.Zero;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">And than I create playbackDevice in AudioPlayback class like this:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">public AudioPlayback(IntPtr aHwnd)</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">{</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>hwnd = aHwnd;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">private void CreateDevice()</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">{</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>WaveCallbackInfo callbackInfo = WaveCallbackInfo.ExistingWindow(hwnd); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>playbackDevice = new WaveOut(callbackInfo);&nbsp;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">But I have never received any messages in WndProc in range &gt;= 0x3BB &lt;= 0x3C0 Which should be messages from WaveOut. I tried WaveCallbackInfo callbackInfo = WaveCallbackInfo.NewWindow() also, but this didn't solve the NullReferenceException problem either.</div>\r\n<p>&nbsp;</p>\r\n<p>I'm trying to use NAudio in WPF, but I have one big problem. I use AudioPlayback (WaveOut playback device) class from NAudioWpfDemo sample project and everything works well with first sound file, but when I try to load and play next sound I've received a NullReferenceException. The same problem is with original NAudioWpfDemo project. I suppose that the problem is with handling messages from WaveOut (because if I make small pause between AudioPlayback.Stop() and AudioPlayback.OpenFile() it works), but I don't know how to handle them in WPF. I tried this:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">private</span> <span style=\"color:Blue\">void</span> Window_Loaded(<span style=\"color:Blue\">object</span> sender, RoutedEventArgs e)\r\n{\r\n\tIntPtr hwnd = <span style=\"color:Blue\">new</span> WindowInteropHelper(<span style=\"color:Blue\">this</span>).Handle;\r\n\tHwndSource.FromHwnd(hwnd).AddHook(<span style=\"color:Blue\">new</span> HwndSourceHook(WndProc));\r\n}\r\n\r\n<span style=\"color:Blue\">private</span> <span style=\"color:Blue\">static</span> IntPtr WndProc(IntPtr hwnd, <span style=\"color:Blue\">int</span> msg, IntPtr wParam, IntPtr lParam, <span style=\"color:Blue\">ref</span> <span style=\"color:Blue\">bool</span> handled)\r\n{\r\n        <span style=\"color:Blue\">if</span> (msg &gt;= 0x3BB &amp;&amp; msg &lt;= 0x3C0)\r\n\t{\r\n                <span style=\"color:Blue\">int</span> x = 0;\r\n\r\n        \tx++;\r\n\t}\r\n\r\n\t<span style=\"color:Blue\">return</span> IntPtr.Zero;\r\n}\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>And than I create playbackDevice in AudioPlayback class like this:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">public</span> AudioPlayback(IntPtr aHwnd)\r\n{\r\n\thwnd = aHwnd;\r\n}\r\n\r\n<span style=\"color:Blue\">private</span> <span style=\"color:Blue\">void</span> CreateDevice()\r\n{\r\n\tWaveCallbackInfo callbackInfo = WaveCallbackInfo.ExistingWindow(hwnd);          \r\n\tplaybackDevice = <span style=\"color:Blue\">new</span> WaveOut(callbackInfo); \r\n}\r\n</pre>\r\n</div>\r\n<p>But I have never received any messages in WndProc in range &gt;= 0x3BB &lt;= 0x3C0 which should be messages from WaveOut. I tried WaveCallbackInfo callbackInfo = WaveCallbackInfo.NewWindow() also, but this didn't solve the NullReferenceException problem either.</p>\r\n<p>Is there a solution? Thank you.</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-01-04T11:16:11.397-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "281199",
    "ThreadId": "79718",
    "Html": "<p>Maybe it could be related to the the callback via Form in wpf<br>Try&nbsp;creating a Form object&nbsp;in your main-window.cs and use that</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>Form f = <span style=\"color:Blue\">new</span> Form();\r\nIntPtr hwnd = <span style=\"color:Blue\">new</span> WindowInteropHelper(f).Handle;\r\n\r\n</pre>\r\n<pre>Edit:</pre>\r\n<pre>Note I havent looked at WindowInteropHelper for a long time.</pre>\r\n</div>",
    "PostedDate": "2010-01-24T15:30:19.21-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]